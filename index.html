<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <title>AI Assistant</title>
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <!-- Add Marked.js for Markdown parsing -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <!-- Add highlight.js for code syntax highlighting -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github-dark.min.css" id="dark-code-theme" disabled>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js"></script>
    
    <!-- Add KaTeX for mathematical expressions -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/katex.min.css" integrity="sha384-GvrOXuhMATgEsSwCs4smul74iXGOixntxFnPZOC7TIz/+GGlQZQxYf6QXpqToKPR" crossorigin="anonymous">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/katex.min.js" integrity="sha384-cpW21h6RZv/phavutF+AuVYrr+dA8xD9zs6FwLpaCct6O9ctzYFYqz3Cm7ZBl9zV" crossorigin="anonymous"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/contrib/auto-render.min.js" integrity="sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05" crossorigin="anonymous"></script>
</head>
<body>
    <!-- Mobile overlay for when sidebar is open -->
    <div class="sidebar-overlay" id="sidebarOverlay"></div>

    <div class="app-container">
        <!-- Sidebar for chat history -->
        <div class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <button id="newChatBtn" class="new-chat-btn">
                    <i class="fas fa-edit"></i>
                </button>
                <button class="mobile-close-sidebar" id="closeSidebarBtn">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="search-box">
                <i class="fas fa-search"></i>
                <input type="text" id="searchChats" placeholder="Search conversations...">
            </div>
            <div class="chat-list" id="chatList">
                <!-- Chat history will be populated here -->
            </div>
        </div>
        
        <!-- Main chat area -->
        <div class="chat-container">
            <header>
                <div class="header-content">
                    <div class="header-left">
                        <button class="mobile-menu-btn" id="toggleSidebarBtn">
                            <i class="fas fa-bars"></i>
                        </button>
                        <button class="model-display-btn" id="modelDisplayBtn">
                            <span id="currentModelName">Qwen 3</span>
                            <i class="fas fa-chevron-down"></i>
                        </button>
                    </div>
                    <div class="header-right">
                        <button id="settingsBtn" class="icon-btn" title="Settings">
                            <i class="fas fa-cog"></i>
                        </button>
                        <button id="themeToggleBtn" class="icon-btn" title="Toggle Dark Mode">
                            <i class="fas fa-moon"></i>
                        </button>
                    </div>
                </div>
            </header>
            
            <div class="chat-box" id="chatBox">
                <!-- Messages will appear here -->
            </div>
            
            <div class="input-area">
                <textarea id="userInput" placeholder="Message AI Assistant..."></textarea>
                <button id="sendBtn">
                    <i class="fas fa-paper-plane"></i>
                </button>
            </div>
            
            <div class="loading" id="loading">
                <div class="spinner"></div>
            </div>
            
            <!-- Mobile new chat button -->
            <button id="mobileNewChatBtn" class="mobile-new-chat-btn">
                <i class="fas fa-plus"></i>
            </button>
        </div>
    </div>
    
    <!-- Model Selection Modal -->
    <div id="modelModal" class="modal">
        <div class="modal-content model-modal-content">
            <div class="modal-header">
                <h2>Select Model</h2>
                <button class="close-modal" id="closeModelBtn">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="model-list" id="modelList">
                    <!-- Models will be dynamically generated -->
                </div>
            </div>
        </div>
    </div>
    
    <!-- Settings Modal -->
    <div id="settingsModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Settings</h2>
                <button class="close-modal" id="closeSettingsBtn">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="settings-section">
                    <h3>System Prompt</h3>
                    <textarea id="systemPrompt" rows="6" placeholder="Enter custom system prompt...">Be talkative and conversational. Respond with corporate jargon. Readily share strong opinions. Get right to the point. Take a forward-thinking view.</textarea>
                </div>
                <div class="settings-section">
                    <h3>Preferences</h3>
                    <div class="setting-item">
                        <label for="fontSize">Font Size</label>
                        <select id="fontSize">
                            <option value="small">Small</option>
                            <option value="medium" selected>Medium</option>
                            <option value="large">Large</option>
                        </select>
                    </div>
                    <div class="setting-item">
                        <label for="codeTheme">Code Theme</label>
                        <select id="codeTheme">
                            <option value="github-dark">GitHub Dark</option>
                            <option value="monokai">Monokai</option>
                            <option value="atom-one-dark">Atom One Dark</option>
                            <option value="vs2015">VS 2015</option>
                        </select>
                    </div>
                </div>
                <div class="settings-actions">
                    <button id="saveSettingsBtn" class="save-btn">Save Settings</button>
                    <button id="resetSettingsBtn" class="reset-btn">Reset to Default</button>
                </div>
            </div>
        </div>
    </div>
    
    <script src="js/script.js"></script>
    
    <!-- Initialize KaTeX auto-render after the page loads -->
    <script>
        document.addEventListener("DOMContentLoaded", function() {
            // Initialize KaTeX when document is fully loaded
            if (window.renderMathInElement) {
                renderMathInElement(document.body, {
                    delimiters: [
                        {left: "$$", right: "$$", display: true},
                        {left: "$", right: "$", display: false},
                        {left: "\\(", right: "\\)", display: false},
                        {left: "\\[", right: "\\]", display: true}
                    ],
                    throwOnError: false
                });
            } else {
                // If renderMathInElement is not immediately available, wait for it
                window.addEventListener('load', function() {
                    if (window.renderMathInElement) {
                        renderMathInElement(document.body, {
                            delimiters: [
                                {left: "$$", right: "$$", display: true},
                                {left: "$", right: "$", display: false},
                                {left: "\\(", right: "\\)", display: false},
                                {left: "\\[", right: "\\]", display: true}
                            ],
                            throwOnError: false
                        });
                    }
                });
            }
        });
    </script>
</body>
</html>